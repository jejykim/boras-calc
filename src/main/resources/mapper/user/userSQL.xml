<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boras.CRM.mapper.UserMapper">
  	
  	<!-- 비밀번호 변경 -->
	<update id="changeUserPw" parameterType="userVO">
		UPDATE users
		SET user_pw = #{userPw},
			user_last_pw_update_date = now()
		WHERE user_id = #{userId}
  	</update>
  	
  	<!-- ID 중복 확인 -->
	<select id="checkUserId" resultType="int" parameterType="userVO">
		SELECT COUNT(*)
		FROM users
		WHERE user_id = #{userId}
  	</select>
  	
  	<!-- 사용자 정보 조회 -->
	<select id="selectUserInfo" resultType="userVO" parameterType="userVO">
		SELECT *
		FROM users
		WHERE user_id = #{userId}
  	</select>
  	
  	<!-- 사용자 목록 조회 -->
	<select id="selectUserList" resultType="userVO" parameterType="userVO">
		SELECT *
		FROM
			(SELECT *
			FROM users
			WHERE use_yn = 'Y'
			<if test="userName != null and userName != ''">
				AND user_name like CONCAT('%',#{userName},'%')
			</if>
			<if test="userId != null and userId != ''">
				AND user_id like CONCAT('%',#{userId},'%')
			</if>
			<if test="userAgCompany != null and userAgCompany != ''">
				AND user_ag_company like CONCAT('%',#{userAgCompany},'%')
			</if>
			<if test="userBusinessTypeCd != null and userBusinessTypeCd != ''">
				AND user_business_type_cd = #{userBusinessTypeCd}
			</if>
			<if test="userPermissionCd != null and userPermissionCd != ''">
				AND user_permission_cd = #{userPermissionCd}
			</if>
			<if test="userUseYn != null and userUseYn != ''">
				AND user_use_yn = #{userUseYn}
			</if>
			) data
		ORDER BY data.user_join_date desc
		LIMIT #{pagePerRows} offset #{page}
  	</select>
  	
  	<!-- 사용자 목록 조회 count -->
	<select id="selectUserListCount" resultType="int" parameterType="userVO">
			SELECT COUNT(*)
			FROM users
			WHERE use_yn = 'Y'
			<if test="userName != null and userName != ''">
				AND user_name like CONCAT('%',#{userName},'%')
			</if>
			<if test="userId != null and userId != ''">
				AND user_id like CONCAT('%',#{userId},'%')
			</if>
			<if test="userAgCompany != null and userAgCompany != ''">
				AND user_ag_company like CONCAT('%',#{userAgCompany},'%')
			</if>
			<if test="userBusinessTypeCd != null and userBusinessTypeCd != ''">
				AND user_business_type_cd = #{userBusinessTypeCd}
			</if>
			<if test="userPermissionCd != null and userPermissionCd != ''">
				AND user_permission_cd = #{userPermissionCd}
			</if>
  	</select>
  	
  	<!-- 사용자 추가 -->
  	<insert id="insertUser" parameterType="userVO">
		INSERT INTO users(
			user_id
			, user_pw
			, user_salt
			, user_name
			, user_email
			, user_business_type_cd
			, user_ag_company
			, user_join_date
			, user_permission_cd
			, use_yn
		) VALUES (
			#{userId}
			, #{userPw}
			, #{userSalt}
			, #{userName}
			, #{userEmail},
			, #{userBusinessTypeCd}
			, #{userAgCompany}
			, now()
			, #{userPermissionCd}
			, 'Y'
		)
  	</insert>
  	
  	<!-- 사용자 수정 -->
	<update id="updateUser" parameterType="userVO">
		UPDATE users
		SET user_name = #{userName},
			user_email = #{userEmail},
			user_ag_company = #{userAgCompany},
			user_permission_cd = #{userPermissionCd},
			<if test="useYn != null and useYn != ''">
				use_yn = #{useYn},
			</if>
		WHERE user_id = #{userId}
  	</update>
  	
  	<!-- 사용자 비활성화 -->
	<update id="updateUserUseN" parameterType="userVO">
		UPDATE users
		SET use_yn = 'N'
		WHERE user_id = #{userId}
  	</update>
  	
</mapper>